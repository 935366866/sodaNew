<html><head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>新建项目</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="content-type" content="text/html" ;="" charset="utf-8">
	<link href="/Public/css/reset.css" rel="stylesheet">
	<link href="/Public/css/bootstrap.min.css" rel="stylesheet">
	<link href="/Public/css/bootstrap-table.css" rel="stylesheet">
	<link href="/Public/css/bootstrap-select.css" rel="stylesheet">
	<link href="/Public/css/jquery-ui-1.9.2.custom.css" rel="stylesheet" type="text/css" media="screen">
	<link href="/Public/css/long_common.css" rel="stylesheet" media="all">
	<link href="/Public/css/soda_common.css" rel="stylesheet">
<style></style></head>

<body style="background-color: rgb(248,248,248);">
	<!--前台公共头部-->
	<div class="top">
	<div class="main_nav1">
		<div class="container">
                          <span id="navLogo">
			<a href="#" class="logo"><img src="/Public/image/navLogo.svg"></a>
                          </span>
			<ul class="main_nav1_left">
				<li id="main"><a href="/Home/News/showMainPage">首页</a></li>
                                <li id="sodaIndex" class="active"><a href="/Home/Mainnobase/">产品体验</a></li>
                                <li id="frontierResearch"><a href="/Home/News/listNewsbytype?sndType=新品快讯">新品快讯</a></li>
                                <li id="marketActive"><a href="/Home/News/listNewsbytype?sndType=市场活动">市场活动</a></li>
			</ul>
				<div class="form-group searchNews" id="search_news">
					<span class="col-sm-2 control-label"><img src="/Public/image/navSearch.svg"></span>
					<div class="col-sm-10">
						<input type="text" class="form-control" id="search_news_input">
					</div>
				</div>
			<ul class="main_nav1_right" style="margin-top:1px">
            	<li id="searchIcon"><a href="#"><img src="/Public/image/navSearch.svg" alt="搜索"></a></li>
				                <li><a href="/Home/Notice/index"><img src="/Public/image/navEmail.svg" alt="通知"></a></li>
                <li><a href="/Home/User/personCenter"><img src="/Public/image/navUser.svg" alt="用户" title="vivian "></a></li>			</ul>
		</div>
	</div>

	<div class="main_nav2">
		<div class="container">
			<ul class="main_nav2_left">
				<li class="nav2_list1" style="width: 90px;">
					<a id="flow" href="/Home/Mainnobase/index?sndType_f=flow" class="active">分析流程<img src="/Public/image/navDown.svg" alt=""></a>
					<ul class="typelist" id="left1">
						<li><a id="" href="/Home/Mainnobase/index?sndType=DNA">DNA分析流程</a></li>
						<li><a id="" href="/Home/Mainnobase/index?sndType=RNA">RNA分析流程</a></li>
						<li><a id="" href="/Home/Mainnobase/index?sndType=medical">医学分析流程</a></li>
					</ul>
				</li>
				<li class="nav2_list2" style="width: 73px;">
					<a onclick="black()" id="小工具" href="/Home/Mainnobase/index?sndType_f=app">小工具<img src="/Public/image/navDown.svg" alt=""></a>
					<ul class="typelist" id="left">
						<li><a href="/Home/Mainnobase/index?sndType=基本绘图">基本绘图</a></li>
					<!--	<li><a  href="/Home/Mainnobase/index?sndType=流程绘图">流程绘图</a></li>
						<li><a  href="/Home/Mainnobase/index?sndType=高级绘图">高级绘图</a></li>
						<li><a  href="/Home/Mainnobase/index?sndType=计算统计">计算统计</a></li>
						<li><a href="/Home/Mainnobase/index?sndType=表格处理">表格处理</a></li>  -->
                                   
				
						 <li><a href="/Home/Mainnobase/building">表格处理</a></li>
                                                <li><a href="/Home/Mainnobase/building">计算统计</a></li>
					</ul>
				</li>
				<li><a id="myproject" href="/Home/Project">我的项目</a></li>
				<li><a id="mydir" href="/Home/Dir/#elf_l1_Lw">我的目录</a></li>
				<li><a id="recycle" href="/Home/Task/showDelTask">回收站</a></li>
                                <li><a id="resource" href="/Home/Task/resourceTask">资源监控</a></li>
			</ul>
				<div class="form-group">
					<div class="col-sm-10">
						<input type="text" class="form-control" placeholder="搜索想要使用的流程或小工具" id="search_flowapp">
					</div>
					<button class="col-sm-2 btn btn_blue" id="search_button">搜索</button>				
				</div>
			</div>
		</div>
	</div>

	


	<!--/前台公共头部-->
	<div class="center_box" style="float:left;width:100%;">
		<div class="flow_title themeRNA">
			<p>有参转录组分析流程V1.0</p>
			<button class="btn btn_title round_Button" onclick="javascrtpt:window.open('/Home/Instruction/showInstruction/refRNA/refRNA')">使用说明</button>
		</div>
			<div class="change_box bigbox_1200" style="padding-left: 0px; padding-right:0px;padding-bottom:50px;">
				<!--
					<button id="changeModule" class="btn btn-primary">切换到模块</button>
				-->
					<!--第一部分 流程图 -->
					<div class="part_box" style=" padding-top:0px; ">

						<div class="task_form_height">
							<label class="task_label"><span>1</span>分析流程</label>
                                          <label class="task_labe2"><span class="span2"></span>未选模块</label>
                                          <label class="task_labe2"><span class="span1"></span>选定摸块</label>
						</div>

						<!--流程图的div-->
						<div id="myDiagramDiv" style="position: relative; -webkit-tap-highlight-color: rgba(255, 255, 255, 0); cursor: auto;"><canvas tabindex="0" width="948" height="470" style="position: absolute; top: 0px; left: 0px; z-index: 2; user-select: none; width: 948px; height: 470px; cursor: auto;">This text is displayed if your browser does not support the Canvas HTML element.</canvas><div style="position: absolute; overflow: auto; width: 948px; height: 470px; z-index: 1;"><div style="position: absolute; width: 1px; height: 1px;"></div></div></div>
						<div style="margin:0 auto ;width:360px;">
							<button type="button" class="btn btn_orange round_Button" id="lockNode" onclick="selectedNode()">锁定模块</button>
							<button type="button" class="btn btn_white round_Button" id="unlockNode" style="margin-left:20px;float:right;" onclick="unlock()">解除锁定</button>
						</div>
						
					</div>

					<!--第二部分表格的填写-->
					<div class="part_box">
						<form class="form-horizontal" id="creatTask" role="form" style="margin-top: 30px;" action="newTask" method="post" onsubmit="return submitForm(this)">
							<input type="hidden" id="task_type" name="task_type" value="ref">
							<input type="hidden" id="id" name="id" value=" ">
							
							<div class=" task_form_height">						
								<label class="task_label label_width"><span>2</span>任务名称</label>
								<div class="task_box">
									<input type="text" class="form-control" required="" id="task_name" name="task_name" placeholder="请填写任务名称">
								</div>
							</div>

							<div class="task_form_height">
								<label class="task_label label_width"><span>3</span>所属项目</label>
								<div class="task_box">
									<select id="project_id" name="project_id" class="selectpicker select_width bs-select-hidden" data-live-search="true">
		
										<optgroup label="可选项目">
										<option value="C3CD82AF-3604-FD27-9890-6D95D6FBD2C6">refRNA</option><option value="3DF470EC-ABE2-8D9B-8BE2-69B29A5B47BF">xiaomi_BSA</option>										</optgroup>
				
									</select><div class="btn-group bootstrap-select select_width"><button type="button" class="btn dropdown-toggle btn-default" data-toggle="dropdown" data-id="project_id" title="refRNA"><span class="filter-option pull-left">refRNA</span>&nbsp;<span class="caret"></span></button><div class="dropdown-menu open"><div class="bs-searchbox"><input type="text" class="form-control" autocomplete="off"></div><ul class="dropdown-menu inner" role="menu"><li class="dropdown-header " data-optgroup="1"><span class="text">可选项目</span></li><li data-original-index="0" data-optgroup="1" class="selected"><a tabindex="0" class="opt  " style="" data-tokens="null"><span class="text">refRNA</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="1" data-optgroup="1"><a tabindex="0" class="opt undefined" style="" data-tokens="null"><span class="text">xiaomi_BSA</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li></ul></div></div>
								</div>

							</div>

							<div class="task_form_height">
								<label class="task_label label_width"><span>4</span>任务目录</label>
								<div class="task_box">
									<input type="url" class="form-control" id="dir_path" name="dir_path" placeholder="请选择任务目录" readonly="">

								</div>
								<a onclick="opendir_path()">
									<span class="glyphicon glyphicon-folder-open" style="font-size:20px; top: 5px; cursor:pointer;color:#7f8080;"></span>
								</a>							

							</div>


							<div class="task_form_height">
								<label class="task_label label_width"><span>5</span>物种名称</label>

								<div class="task_box">
									<select id="species" name="species" class="selectpicker select_width bs-select-hidden" data-live-search="true">
				
										<optgroup label="可选物种">
											<option value="Oryza_sativa_Japonica">Oryza_sativa_Japonica (rice)</option><option value="Ziziphus_jujuba">Ziziphus_jujuba (Ziziphus)</option>										</optgroup>
				
									</select><div class="btn-group bootstrap-select select_width"><button type="button" class="btn dropdown-toggle btn-default" data-toggle="dropdown" data-id="species" title="Oryza_sativa_Japonica (rice)"><span class="filter-option pull-left">Oryza_sativa_Japonica (rice)</span>&nbsp;<span class="caret"></span></button><div class="dropdown-menu open"><div class="bs-searchbox"><input type="text" class="form-control" autocomplete="off"></div><ul class="dropdown-menu inner" role="menu"><li class="dropdown-header " data-optgroup="1"><span class="text">可选物种</span></li><li data-original-index="0" data-optgroup="1" class="selected"><a tabindex="0" class="opt  " style="" data-tokens="null"><span class="text">Oryza_sativa_Japonica (rice)</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="1" data-optgroup="1"><a tabindex="0" class="opt undefined" style="" data-tokens="null"><span class="text">Ziziphus_jujuba (Ziziphus)</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li></ul></div></div>
								</div>
							</div>

							<div class="task_form_height">
								<label class="task_label label_width"><span>6</span>链特异性文库</label>
								<div class="task_box">
									<select id="is_sslib" name="is_sslib" class="selectpicker select_width bs-select-hidden">
				
										<option value="no">NO</option>
										<option value="yes">YES</option>
				
									</select><div class="btn-group bootstrap-select select_width"><button type="button" class="btn dropdown-toggle btn-default" data-toggle="dropdown" data-id="is_sslib" title="NO"><span class="filter-option pull-left">NO</span>&nbsp;<span class="caret"></span></button><div class="dropdown-menu open"><ul class="dropdown-menu inner" role="menu"><li data-original-index="0" class="selected"><a tabindex="0" class="" style="" data-tokens="null"><span class="text">NO</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="1"><a tabindex="0" class="" style="" data-tokens="null"><span class="text">YES</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li></ul></div></div>
								</div>
							</div>

							<div class="task_form_height">
								<label class="task_label label_width"><span>7</span>测序类型</label>
								<div class="task_box">
									<select id="seq_type" name="seq_type" class="selectpicker select_width bs-select-hidden">
		
									<option value="pe">PE(Pair-End)</option>
									<option value="se">SE(Single-End)</option>
			
								</select><div class="btn-group bootstrap-select select_width"><button type="button" class="btn dropdown-toggle btn-default" data-toggle="dropdown" data-id="seq_type" title="PE(Pair-End)"><span class="filter-option pull-left">PE(Pair-End)</span>&nbsp;<span class="caret"></span></button><div class="dropdown-menu open"><ul class="dropdown-menu inner" role="menu"><li data-original-index="0" class="selected"><a tabindex="0" class="" style="" data-tokens="null"><span class="text">PE(Pair-End)</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li><li data-original-index="1"><a tabindex="0" class="" style="" data-tokens="null"><span class="text">SE(Single-End)</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li></ul></div></div>
								</div>
							</div>

							<!--数据目录-->
							<div class="task_form_height">
								<label class="task_label label_width"><span>8</span>数据目录</label>
								<div class="task_box">
									<input type="url" class="form-control " required="" id="data_dir" name="data_dir" placeholder="请选择数据目录" readonly="">
								</div>
								<a onclick="openDataUrl()">
									<span class="glyphicon glyphicon-folder-open" style="font-size:20px; cursor:pointer;color:#7f8080;"></span>
								</a>
							</div>

						</form>

					<!--第二部分 选择sample的表格 -->
					<div class="task_form_height">
					<div class="task_label">&nbsp;</div>
					<div class="task_box">
						
						<div class="bootstrap-table"><div class="fixed-table-toolbar"><div class="bars pull-left"><div id="toolbar">
							<button id="removeDataTable" class="btn btn-default">删除行</button>
						</div></div></div><div class="fixed-table-container" style="height: 195px; padding-bottom: 40px;"><div class="fixed-table-header" style="margin-right: 0px;"><table class="table table-hover" style="width: 523px;"><thead><tr><th class="bs-checkbox " style="width: 36px; " data-field="state" tabindex="0"><div class="th-inner "><input name="btSelectAll" type="checkbox"></div><div class="fht-cell"></div></th><th style="text-align: left; " data-field="sample" tabindex="0"><div class="th-inner sortable both">样本名称</div><div class="fht-cell"></div></th><th style="text-align: center; " data-field="fq" tabindex="0"><div class="th-inner sortable both">FastQ文件 </div><div class="fht-cell"></div></th></tr></thead></table></div><div class="fixed-table-body"><div class="fixed-table-loading" style="top: 41px;">Loading, please wait...</div><table data-toggle="table" data-toolbar="#toolbar" data-click-to-select="true" data-show-footer="false" data-height="250" id="sampleTable" class="table table-hover" style="margin-top: -40px;">
							<thead><tr><th class="bs-checkbox " style="width: 36px; " data-field="state" tabindex="0"><div class="th-inner "><input name="btSelectAll" type="checkbox"></div><div class="fht-cell"></div></th><th style="text-align: left; " data-field="sample" tabindex="0"><div class="th-inner sortable both">样本名称</div><div class="fht-cell"></div></th><th style="text-align: center; " data-field="fq" tabindex="0"><div class="th-inner sortable both">FastQ文件 </div><div class="fht-cell"></div></th></tr></thead>
						<tbody><tr class="no-records-found"><td colspan="3">No matching records found</td></tr></tbody></table></div><div class="fixed-table-footer" style="display: none;"><table><tbody><tr></tr></tbody></table></div><div class="fixed-table-paginations"></div></div></div><div class="clearfix"></div>
						<div style="width:360px;margin:0 auto;padding-top:40px;padding-bottom:40px;">
							<button id="getSamples" class="btn btn_orange round_Button" style="margin-top: 10px;">锁定样本</button>
							<button class="btn btn_white round_Button" id="unlockSamples" style="margin-top: 10px; margin-left:20px;">解除样本</button>
						</div>
					</div>
					</div>

					</div>
					<!-- ------------------------------------------------------------------------------------------------- -->
					<!-- 添加选择目录的模态框 -->
					<div class="modal fade" id="selectUrl" tabindex="-1" aria-labelledby="选择路径" aria-hidden="true">

						<div class="modal-dialog" style="top:50px; width:800px;">
							<div class="modal-content ">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
										×
									</button>
									<h4 class="modal-title">
										路径 (请选择一个"文件夹"，不是一个"文件")
									</h4>
									<div class="input-group">
										<input type="text" class="form-control" id="inputUrl">
										<span class="input-group-btn">
											<button class="btn btn-default glyphicon glyphicon-arrow-left" id="back" type="button" style="top: 0px;"></button>
											<button class="btn btn-default glyphicon glyphicon-arrow-right" id="search" type="button" style="top: 0px;"></button>
										</span>
									</div>
								</div>
								<!-- ---------------data-single-select="true"-------------------------------------------------------------------- -->
								<div class="modal-body" style="text-align:center; ">
									<div class="bootstrap-table"><div class="fixed-table-toolbar"></div><div class="fixed-table-container" style="height: 300px; padding-bottom: 0px;"><div class="fixed-table-header"><table></table></div><div class="fixed-table-body"><div class="fixed-table-loading" style="top: 1px;">Loading, please wait...</div><table data-toggle="table" data-minimum-count-columns="2" data-id-field="id" data-show-footer="false" data-height="300" data-sort-name="id" data-click-to-select="true" id="jobUrlTable" style="bottom:20px;" class="table table-hover">

										<thead><tr><th class="bs-checkbox " style="width: 36px; " data-field="state" tabindex="0"><div class="th-inner "><input name="btSelectAll" type="checkbox"></div><div class="fht-cell"></div></th><th style="" data-field="icon" tabindex="0"><div class="th-inner "></div><div class="fht-cell"></div></th><th style="text-align: left; " data-field="name" tabindex="0"><div class="th-inner sortable both">name</div><div class="fht-cell"></div></th><th style="text-align: center; " data-field="type" tabindex="0"><div class="th-inner sortable both">attribute</div><div class="fht-cell"></div></th><th style="text-align: center; " data-field="size" tabindex="0"><div class="th-inner sortable both">size</div><div class="fht-cell"></div></th><th style="text-align: center; " data-field="owner" tabindex="0"><div class="th-inner sortable both">owner</div><div class="fht-cell"></div></th><th style="text-align: center; " data-field="group" tabindex="0"><div class="th-inner ">group</div><div class="fht-cell"></div></th><th style="text-align: center; " data-field="mtime" tabindex="0"><div class="th-inner sortable both">time</div><div class="fht-cell"></div></th></tr></thead>
									<tbody><tr class="no-records-found"><td colspan="8">No matching records found</td></tr></tbody></table></div><div class="fixed-table-footer" style="display: none;"><table><tbody><tr></tr></tbody></table></div><div class="fixed-table-paginations"></div></div></div><div class="clearfix"></div>
								</div>
								<!-- ----------------------------------------------------------------------------------- -->
								<div class="modal-footer">
									<button type="button" id="selected" class="btn btnBlue">
									选择
									</button>
									<button type="button" id="cancel" class="btn btn-default" data-dismiss="modal">
									关闭
									</button>
								</div>
							</div>
						</div>
					</div>
					<!-- ---------------------------------------------------------------------- -->
					<!--第四部分 模块参数设置-->

					<div class="part_box">

						<div class="task_form_height">
							<label class="task_label"><span>9</span>模块参数设置</label>
							<!--点击展开参数-->
							<div class="panel-group params_part" id="parasPanel">
							</div>							
						</div>
						

						
					</div>
					<!-- ------------------------------参数设置结束-------------------------------- -->
					<!--第五部分 样本分组、比较、维恩图 -->
					<!-- 样本分组、比较、维恩图 -->
					<div class="part_box">
						<!--带星 分组比较标题-->
						<div class="task_form_height">
							<label class="task_label"><span>10</span>分组比较</label>
								<!--带有拖拽内容的面板-->
						<div class="sample_part">
							<div class="panel panel-default" style="padding:0px;">
								<div class="panel-heading">
									<h4><span class="glyphicon glyphicon-edit"></span> Sample Group</h4>
								</div>
								<div class="panel-body" style="padding: 15px 2px 15px 20px !important;">
                  
									<div>
									<div style="float:left;width:18%;margin-right:15px;">
										<div>
										<label class="control-label"><b>样本名称：</b></label>
										</div>
									</div>
									<div style="float:left;width:22%;margin-right:14px;">
										<div>
											<button class="btn btn-default" data-target="#groupModal" data-toggle="modal" style="outline: none;">
												<span class="glyphicon glyphicon-plus">Group</span>
											</button><br>
										</div>
									</div>
									<div style="float:left;width:22%;margin-right:14px;">
										<div>
											<button class="btn btn-default" data-target="#compareModal" data-toggle="modal" style="outline: none;">
												<span class="glyphicon glyphicon-plus">Compare</span>
											</button>
										</div>
									</div>
									<div style="float:left;width:22%">
										<div>
											<button class="btn btn-default" id="addVenn" style="outline: none;">
												<span class="glyphicon glyphicon-plus">Venn</span>
											</button>
										</div>
									</div>
									</div>
									<div>
									<div style="width:100%;">
										<div>
										<div style="float:left;width:18%;margin-right:15px;">
											<br>
											<div>
											<ol id="sampleNames" class="list-group sampleNames ui-helper-reset ui-helper-clearfix ui-droppable" style="height: 100%;">
											</ol>
											</div>
										</div>
										<div id="groupList" style="float:left;width:22%;margin-right:14px;"><br></div>
										<div id="compareList" style="float:left;width:22%;margin-right:14px;"><br></div>
										<div id="vennList" style="float:left;width:22%"><br></div>
										</div>
									</div>
									</div>
								</div>
							</div>
						</div>
						</div>						

					

					<!-- group modal -->
					<div class="row">
						<div style="width:100%;">
							<div class="row">
								<div class="modal fade " id="groupModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
									<div class="row">
										<div id="list_model" class="modal-dialog " style="width:20%">
											<div class="modal-content">
												<div class="modal-header">
													<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
													<h4 class="modal-title" id="myModalLabel">组名</h4>
													<div class="input-group">
														<input id="groupName" class="form-control" value="">

														<span id="addGroup" class="glyphicon glyphicon-circle-arrow-right input-group-addon"></span>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<!-- /.modal end -->
							</div>
						</div>
					</div>
					<!-- venn modal -->
					<div class="row">
						<div style="width:100%;">
							<div class="row">
								<div class="modal fade " id="compareModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
									<div class="row">
										<div id="list_model" class="modal-dialog " style="width:20%">
											<div class="modal-content">
												<div class="modal-header">
													<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
													<h4 class="modal-title" id="myModalLabel">组间比较</h4>
													<div class="input-group">
														<input id="compareName" class="form-control" value="">
														<span id="addCompare" class="glyphicon glyphicon-circle-arrow-right input-group-addon"></span>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<!-- /.modal end -->
							</div>
						</div>
					</div>

				</div>

					<!-- --------------------------------------------------------------------------------------- -->
					<!-- --运行-- -->
					<!--			<img src="image/run.png" style="height:40px; width:40px; float:right; cursor:pointer ;" id="taskRun"></img>   -->
					<div class="task_form_height">
						<label class="task_label"><span><img style="padding-bottom: 5px;" src="/Public/img/arrowLeft.svg"></span>提交任务</label>
						<div class="run_style">
							<button type="submit" class="btn submitBut" id="taskRun" style="float:left;padding: 0px; border-width: 0px;">
								<img src="/Public/img/grunGreen.svg" alt="">
							</button>
						</div>

					</div>
					<!--  old button
					<div style="margin:0 auto ;width:360px;">
						<button type="button" class="btn btn-info submitBut" id="saveDraft">保存草稿</button>
						<button type="submit" class="btn btn-primary submitBut" id="taskRun" style="float:right;">运行任务</button>
					</div>
					-->

			</div>
	</div>
	 <!--页脚-->
	    <div id="footer_style">
        <footer class="footerstyle">
           <p>版权所有 © 2017 京ICP备17048617号</p>
            <p>北京拓美科基因科技有限公司</p>
        </footer>
    </div>

        <!--页脚-->
	<script src="/Public/js/jquery-1.11.2.min.js"></script>
	<script src="/Public/js/bootstrap.min.js"></script>
	<script src="/Public/js/bootstrap-table.js"></script>
	<script src="/Public/js/bootstrap-select.js"></script>
	<script src="/Public/js/jquery-ui-1.9.2.custom.min.js" type="text/javascript"></script>
	<script src="/Public/js/jquery.blockUI.js" type="text/javascript"></script>
	<script src="/Public/js/long_common.js"></script>
	<script src="/Public/js/go.js"></script>
	<script src="/Public/js/common.js"></script>
	<!--<script type="text/javascript" src="/Public/js/heart.js"></script>
	-->
	<script type="text/javascript">
	var module = "/Home";
	</script>
    <script>
          $(function(){
                   $("#sodaIndex").addClass("active");
                   $("#flow").addClass("active");
                          
                      $("#mydir").mouseenter(function(){
                                $("#mydir").addClass("active");
                                                          }); 
                               $("#mydir").mouseleave(function(){
                                 $("#mydir").removeClass("active");
                                                         });
                        
                        $("#小工具").mouseenter(function(){
                        $("#小工具").addClass("active");
                                                          }); 
                        $("#小工具").mouseleave(function(){
                        $("#小工具").removeClass("active");
                                                          });
                       $("#resource").mouseenter(function(){
                        $("#resource").addClass("active");
                                                          }); 
                        $("#resource").mouseleave(function(){
                        $("#resource").removeClass("active");
                                                          });

                       
                        $("#recycle").mouseenter(function(){
                        $("#recycle").addClass("active");
                                                          }); 
                        $("#recycle").mouseleave(function(){
                        $("#recycle").removeClass("active");
                                                          });
                        
                        $("#myproject").mouseenter(function(){
                        $("#myproject").addClass("active");
                                                          }); 
                        $("#myproject").mouseleave(function(){
                        $("#myproject").removeClass("active");
                                                          });

                                $('.typelist li a').hover(function(){
						$(this).css('color','#333333');
						$(this).css('font-weight','bold');
					},function(){
						$(this).css('color','#959595');
						$(this).css('font-weight','400');
					})

			
                        
          
          })
    </script>

	<script>
		$(function(){
			$('#creatTask label').addClass('label_width');   //含有任务名称等基本信息的表格中label
		});

		//判断是否是草稿，加载任务参数填写时option的值
		var nodeStatus=
		{
			'Basic_QC':1,
			'Alignment':1,
			'Advanced_QC':1,
			"SNP_INDEL":1,
			"Assemble":1,
			"AS":1,
			"DE":1,
			"PPI":1,
			"GO":1,
			"KEGG":1
		};
		var  requiredNode=new Array("Basic_QC"); //必选模块
		//各种默认参数的url
		var nodeParaUrl="json/draft.json";  // 节点参数的默认值的url
		var samplesDataUrl = "/Home/Data/remoteDirView"; //像后台发送目录的地址
		$(document).ready(function(){ 
		//调出默认数据存为变量
			var id = $("#id").val().replace(' ','');
			if(id==null || id==''){
				return ;
			}
			draftTask(nodeParaUrl,samplesDataUrl);   //传入草稿的数据,发送数据目录的地址
			});
		
		//设置每个节点的状态
		$(document).ajaxStart($.blockUI).ajaxStop($.unblockUI);
		
		var requiredColor="rgb(56,190,237)";
		var selectColor="rgb(56,190,237)";
		var unselectColor="lightgray";
		var arrowColor="rgb(100,100,100)";
		var nodeNameColor="rgb(255,255,255)";
		var nodeBorderColor="rgb(167,167,167)";
		
		$(function (){
			 var $ = go.GraphObject.make;  // for conciseness in defining templates
		//	var diagram = new go.Diagram("myDiagramDiv");
		//---------------
		
		diagram =
		      $(go.Diagram, "myDiagramDiv",  // must name or refer to the DIV HTML element
		        {
		          initialContentAlignment: go.Spot.Center,
		          allowDrop: false,  // must be true to accept drops from the Palette
		 //         "LinkDrawn": showLinkLabel,  // this DiagramEvent listener is defined below
		//          "LinkRelinked": showLinkLabel,
		          "animationManager.duration": 800, // slightly longer than default (600ms) animation
		          "undoManager.isEnabled": false  // enable undo & redo
		        });
		
		//----------------
	

		//节点的样式
		diagram.nodeTemplate =
			$(go.Node, "Auto",
 
			  new go.Binding("location", "loc", go.Point.parse),
			  $(go.Shape, "RoundedRectangle", { fill: selectColor ,
			  									parameter1: 5,  // the corner has a large radius
			  									stroke:nodeBorderColor,
												
												},
												new go.Binding("fill", "color")
												),     
										
			  {
				  selectionAdornmentTemplate:
				  $(go.Adornment, "Auto",
					$(go.Shape, "RoundedRectangle",
					{ fill: null, stroke: selectColor, strokeWidth: 1 }),
					$(go.Placeholder)
				  )  // end Adornment
			  },
				
				
			  $(go.TextBlock,{ font: "bold 14px sans-serif",
							   stroke: nodeNameColor,
							   margin: 10 },
				new go.Binding("text", "key"))
			);

		
		//连线的样式
	   diagram.linkTemplate =
		  $(go.Link,  // the whole link panel
			{ curve: go.Link.Bezier, reshapable: true },
			// don't need to save Link.points, so don't need TwoWay Binding on "points"
			new go.Binding("curviness", "curviness").makeTwoWay(),  // but save "curviness" automatically
			$(go.Shape,  // the link shape
			  { strokeWidth: 2 ,stroke:arrowColor }),
	//		  new go.Binding("stroke", "color"),
			$(go.Shape,  // the arrowhead
			  { toArrow: "standard", stroke: null, fill:arrowColor })
			
		  );  

//单击元素，直接获得 key
		diagram.addDiagramListener("ObjectSingleClicked",
			      function(e) {
					  if(nodeLockStatus == 1){
							var part = e.subject.part;
							var color = part.elt(0).fill;
							obj = part
							
					     if(  jQuery.inArray(obj.data.key, requiredNode) == -1 ){   //单击的节点不在必选的节点当中
							 if(color == selectColor){
								part.elt(0).fill = unselectColor;
								nodeStatus[obj.data.key] = 0;
						//		nodeStatus[nodeName] = 0;
								findChildren(obj);
						//		console.log(nodeStatus[nodeName])
						
								}
								
							if(color == unselectColor){
								part.elt(0).fill = selectColor;
								nodeStatus[obj.data.key] = 1;
						//		nodeStatus[nodeName] = 1;
								findParents(obj);
						//		console.log(nodeStatus[nodeName])
								}
						  };
					  };
					  if(nodeLockStatus == 0){
						  alert("无法编辑，请先解锁模块")
						  };
			      });
			//找到选中节点的子节点
			function findChildren(obj){
				var it = obj.findTreeChildrenNodes();    //找到所有的子节点
			    for(var i=0;i<it.count;i++){             //遍历子节点
					if(it.next()){   
						var cObj=it.value;   
						if(  jQuery.inArray(cObj.data.key, requiredNode) == -1 ){   //单击的节点不在必选的节点当中
							it.value.elt(0).fill=unselectColor;//变成灰色
							nodeStatus[cObj.data.key] = 0;
						};
						       
						var cNum= cObj.findTreeChildrenNodes().count;//console.log(cNum);
						if(cNum != 0){
							findChildren(cObj);
							}; 
					};
				}	
			}
			//找到父节点
			function findParents(obj){
				var it = obj.findNodesInto();
			    for(var i=0;i<it.count;i++){  
					if(it.next()){
						var pObj=it.value;
						if(  jQuery.inArray(pObj.data.key, requiredNode) == -1 ){   //单击的节点不在必选的节点当中 
							it.value.elt(0).fill=selectColor
							nodeStatus[pObj.data.key] = 1;
						};
						var pNum=pObj.findNodesInto().count;//console.log(cNum);
						if(pNum != 0){
							findParents(pObj);
							}; 
					};
					
					}	
//				while(it.next())(it.value.elt(0).fill=unselectColor)
				}
					
		
  var nodeDataArray = [
		{key: "Basic_QC", loc:"0 0"},
		{key: "Alignment", loc:"-5 100"},
		{key: "Advanced_QC", loc:"150 100"},
		{key: "SNP_INDEL", loc:"160 200"},
		{key: "Assemble", loc:"0 200"},
		{key: "AS", loc:"-100 200"},
		{key: "DE", loc:"25 300"},
		{key: "PPI", loc:"-70 400"},
		{key: "GO", loc:"25 400"},
		{key: "KEGG", loc:"120 400"}
	  ];
  
  var linkDataArray = [
		{from: "Basic_QC", to:"Alignment", "curviness":0},
		{from: "Alignment", to:"Advanced_QC", "curviness":0},
		{from: "Advanced_QC", to:"SNP_INDEL", "curviness":0},
		{from: "Alignment", to:"Assemble", "curviness":0},
		{from: "Assemble", to: "AS", "curviness":0},
		{from: "Assemble", to: "DE", "curviness":0},
		{from: "DE", to: "PPI", "curviness":-20},
		{from: "DE", to: "GO", "curviness":0},
		{from: "DE", to: "KEGG", "curviness":20}
	  ];
 
	 diagram.model = new go.GraphLinksModel(nodeDataArray, linkDataArray);	
	 diagram.initialContentAlignment = go.Spot.Center; //整个图居中	
//	 diagram.toolManager.mouseWheelBehavior = false ;  //控制放大缩小
//	 diagram.allowDrop = false;
//	 diagram.animationManager.isEnabled = false ;
	
	});


//选定的模块

var nodeLockStatus=1  //可编辑
//解锁
function unlock(){
	nodeLockStatus=1;
	$("#lockNode").attr("class","btn btn_orange round_Button");
	$("#unlockNode").attr("class","btn btn_white round_Button");
	$("#parasPanel").html("");  //清空现有的参数
	};
//点击锁定模块
function selectedNode(){
	$("#unlockNode").attr("class","btn btn_orange round_Button");
	$("#lockNode").attr("class","btn btn_white round_Button");
	if(nodeLockStatus == 1){  //判断是否是解锁状态
		$("#parasPanel").html(""); //清空现有的参数
	for(var key in nodeStatus){
		if (nodeStatus[key] == 1){
//加载json相应模块的数据到模块参数设置当中
			
			//添加该模块的面板
			if(! defaultRefParams[key]){
				continue;
			}
			$("#parasPanel").append('<div class="panel panel-default"  id="' + key + '"><div class="panel-heading"><h4 class="panel-title"><a data-toggle="collapse" data-parent="#' + key + '" href="#' + key + '_panel_body">' + key + ' 参数设置</a></h4></div><div id="' + key + '_panel_body" class="panel-collapse collapse in"><div class="panel-body"><form class="form-horizontal" role="form"></form></div></div></div>');
			addPara(key); //添加面板中的参数

		};
	};
	};
	nodeLockStatus=0; 

};
//在参数设置中 给node名字为key的模块 添加input或dropdown参数
function addPara(key){
				var data = defaultRefParams;
				items = data[key];   //找到参数中键为key的node项目
				if(typeof(items)=='undefined' || items==null){
					return;
				}	
				for (var i=0; i < items.length; i++){   //遍历其中的许多参数
					if(items[i]["type"] == "input"){   //添加一个input框
						
						var name = items[i]["name"]
						var id = items[i]["id"]
						var value = items[i]["value"]
						var info = items[i]["illustration"]
						//添加input的代码
					
						$("#" + key + " form").append('<div class="form-group"><label class="col-sm-3 control-label">' + name + '</label><div class="col-sm-7"><input type="text"  class="form-control" required id="'+ id +'" name="'+ id +'" title="' + info + '"></div><a class="col-sm-2 control-label"  style=" text-align:left;" onclick="paraDefult('+key+','+id+')">默认值</a></div>');
						
						//向input中添加默认值
						$("#" + id).val(value);
						};

					if(items[i]["type"] == "dropdown"){   //添加一个下拉框
						var name = items[i]["name"]
						var id = items[i]["id"]
						var value = items[i]["value"].split(";")
						var info = items[i]["illustration"]
						var opts = ""
						for (var j=0;j < value.length; j++){
							var tmpArr = value[j].split(',');
							if (tmpArr.length <2){
								tmpArr[1] = tmpArr[0];
							}
							opts += '<option value="'+tmpArr[0]+'">' + tmpArr[1] + '</option>';   //给option添加一个value
							};
					
						//添加dropdown的代码
						$("#" + key + " form").append('<div class="" ><label title="'+info+'" class="col-sm-3 control-label">' + name + '</label><div class="col-sm-7" ><select class="form-control" id="'+ id +'" name="'+ id +'"  title="">' + opts + '</select></div></div>');
						};	
						$("#"+id).selectpicker({
							  liveSearch: true,
						});
					};
	
			
	};
//点击恢复默认值
function paraDefult(key,id){
	var key = key.id;
	var id = id.id;	
//	$.getJSON(nodeParaUrl,function(data){  //始终从json文件中读取默认值
		var data = constDefaultRefParams;

		var items = data[key];
		for (var i=0; i < items.length; i++){ 
			if(items[i]["id"] == id){
				
				$("#"+id).val(items[i]["value"]);
				};
				
			};
//	});

	};
	
//-----------------------------------点击打开目录--------------------------------------------	
//打开任务目录
function opendir_path(){
	var inputValue = $("#dir_path").val();  //当前input的值
	$("#inputUrl").val(inputValue);
	//console.log(inputValue)
	$('#selectUrl').modal('show');
    $("#selected").attr("onClick","geturl('#dir_path','dir')")
};


//打开数据目录
function openDataUrl(){
	if(samplesLock == 1){
		var inputValue = $("#data_dir").val();  //当前input的值
		$("#inputUrl").val(inputValue);
		//console.log(inputValue)		
		$('#selectUrl').modal('show');   //显示模态框
		$("#selected").attr("onClick","geturl('#data_dir','dir')")
	};
	if(samplesLock == 0){
		alert("样本已经锁定，请先解锁")
	}
};

//选择目录时添加文件或者目录的图标
function addIcon(State, row) {
	var typeChr = row.type.charAt(0);
		
	if(typeChr == 'd'){
		return '<span class="glyphicon glyphicon-folder-open"></span>';
		}
	else{
		return '<span class="glyphicon glyphicon-file"></span> ';
		}
};

//当模态框加载完成后给input中添加当前用户的根目录
$(function(){
		  dblCilck('jobUrlTable','inputUrl',samplesDataUrl);
		  $('#selectUrl').on('shown.bs.modal', function () {    //模态框完全显示之后把根目录放入
	      	//$("#inputUrl").val("/home/dodogene/");
		  	if($("#inputUrl").val()==''){
		  		$("#inputUrl").val('/home/dodogene/refRNA/osa2group');
		  	}
		  	checkUrl($("#inputUrl").val(), samplesDataUrl, 'inputUrl','jobUrlTable');
		  });
});


//回车查目录是否存在
$(function(){
	$('#inputUrl').bind('keypress',function(event){
		if(event.keyCode == "13")    
		{
			newUrl = $("#inputUrl").val();
			checkUrl(newUrl,samplesDataUrl,"inputUrl","jobUrlTable"); //参数依次为需要检查的URL， 后台的地址， 需要更新的输入框id， 需要刷新的bootstrap table
		}
	});
//点击右边箭头，检查	
	$("#search").click(function(){  
    	  newUrl = $("#inputUrl").val();
		  checkUrl(newUrl,samplesDataUrl,"inputUrl","jobUrlTable");
    });  
//后退按钮
	$("#back").click(function(){  
    	   Url= $("#inputUrl").val();
		   
		   lastLen =Url.split('/').pop().length
		   newUrl = Url.substring(0,Url.length - lastLen-1);
		   checkUrl(newUrl,samplesDataUrl,"inputUrl","jobUrlTable");
    }); 
	
});
//点击选择关闭模态框，将当前模态框input中的路径取出放入表单中
/*
function geturl(formInputId){
	var singleName = ""   //选择一个文件夹或者文件的名字，单选
	$.map($('#jobUrlTable').bootstrapTable('getSelections'), function (row) {
		singleName = row.name
	});
	
	var newUrl = $("#inputUrl").val() + singleName;    //点击选择时取input中当前的路径，在加上此时选择的
	var sequencingType = $("#seq_type").val();
	$("#selected").removeAttr("onClick");
	$("#selectUrl").modal('hide');
	$(formInputId).val(newUrl);
	if(formInputId == "#data_dir"){
		$.ajax({
				url:samplesDataUrl,  
				type:'post',
				data:{url:newUrl},
				dataType: "json",
				success:function(data,textStatus) {
					if(data['status']=='ERROR'){    //请求成功但没有执行成功
						alert(data['data']);
					}else{
						var data1 = data['data'];
						objData = dataTableGet(data1,sequencingType);   //向后台传输数据，返回值组成Json
						
						$('#sampleTable').bootstrapTable('load',objData);  //填入table中
					}
				  },    
				error : function(XMLHttpRequest) {
					alert(XMLHttpRequest.status +' '+ XMLHttpRequest.statusText);   
				 }
			}); 
		
		};
};
*/
//点击选择关闭模态框，将当前模态框input中的路径取出放入表单中,type 的类型 暂时有两种，dir和 file
function geturl(formInputId,type){

	var selected_num = checkedNum("jobUrlTable");
	if(type == "dir"){
		//只能选择文件夹，单选
		var newUrl = ""
		
		if(selected_num == 1){
			//此时选中了一项，判断是否是目录			
			var singleName = ""   //选择一个文件夹或者文件的名字，单选
			$.map($('#jobUrlTable').bootstrapTable('getSelections'), function (row) {
				var d_f_type = "";
				d_f_type = row.type.charAt(0);
				if(d_f_type == "d"){
					singleName = row.name;
					newUrl = $("#inputUrl").val() + "/"+ singleName;    //点击选择时取input中当前的路径，在加上此时选择的
					//newUrl = '/ddgene'.newUrl.replace('//','/');
                              newUrl = newUrl.replace('//','/');
					$("#selected").removeAttr("onClick");   //选择按钮
					$("#selectUrl").modal('hide');          //隐藏目录选择的模态框
					$(formInputId).val(newUrl);	
					if(formInputId == "#data_dir"){

						var sequencingType = $("#seq_type").val();
						$.ajax({
								url:samplesDataUrl,  
								type:'post',
								data:{url:newUrl},
								dataType: "json",
								success:function(data,textStatus) {
									if(data['status']=='ERROR'){    //请求成功但没有执行成功
										alert(data['data']);
									}else{
										var data1 = data['data'];

										objData = dataTableGet(data1,sequencingType);   //向后台传输数据，返回值组成Json
										
										$('#sampleTable').bootstrapTable('load',objData);  //填入table中
									}
								},    
								error : function(XMLHttpRequest) {
									alert(XMLHttpRequest.status +' '+ XMLHttpRequest.statusText);   
								}
						}); 
					
					};
				}else{
					alert("对不起，您选择的必须是目录文件！");
				
				};
						
			});
			
		
		}else if(selected_num == 0){
			//没有选中任何项，将此时的url传到前面

			newUrl = $("#inputUrl").val();    //点击选择时取input中当前的路径，在加上此时选择的
			//newUrl = '/ddgene'.newUrl.replace('//','/');
                   newUrl = newUrl.replace('//','/');
			$("#selected").removeAttr("onClick");
			$("#selectUrl").modal('hide');
			$(formInputId).val(newUrl);

			var sequencingType = $("#seq_type").val();
			$.ajax({
					url:samplesDataUrl,  
					type:'post',
					data:{url:newUrl},
					dataType: "json",
					success:function(data,textStatus) {
						if(data['status']=='ERROR'){    //请求成功但没有执行成功
							alert(data['data']);
						}else{
							var data1 = data['data'];
							objData = dataTableGet(data1,sequencingType);   //向后台传输数据，返回值组成Json
							
							$('#sampleTable').bootstrapTable('load',objData);  //填入table中
						}
					},    
					error : function(XMLHttpRequest) {
						alert(XMLHttpRequest.status +' '+ XMLHttpRequest.statusText);   
					}
			}); 
		}
		else{
			//选择了多项，直接报错
			alert("对不起，只能选择一个目录文件！");
		};
		
	}
	else if(type == "file"){
		//只能选择文件，多选
		var newUrl = ""
		var files = [];
		var have_dir = 0
		$.map($('#jobUrlTable').bootstrapTable('getSelections'), function (row) {
			var d_f_type = "";
			d_f_type = row.type.charAt(0);
			if(d_f_type == "d"){
				have_dir = 1;
			}else{
				files.push(row.name);
			}
			
		});
		if(have_dir == 1){
			alert("对不起，不能选择文件夹，只能选择文件！");
		}else{
			if(files.length == 0){
				alert("请选择文件！")
			}else{
				//获得当前的目录，取消绑定，关闭模态框，在外面填写
				newUrl = $("#inputUrl").val();
				//newUrl = '/ddgene'.newUrl.replace('//','/');
                        newUrl = newUrl.replace('//','/');
				$("#selected").removeAttr("onClick");
				$("#selectUrl").modal('hide');
				$(formInputId).val(newUrl);
				//清空样本
				$(formInputId).nextAll().remove();
				for(var i=0; i< files.length; i++){
					$(formInputId).after('<span class="label label-default span_sample">'+files[i]+'<a href="javascript:void(0);" onclick="remover_this_sample(this)" class="glyphicon glyphicon-remove colorRNA"></a></span>');
				};
			};
		};

	}
	else{
		return false;
	}

};
//删除选中的行
    $(function () {
        $('#removeDataTable').click(function () {
			if(samplesLock == 1){
				var ids = $.map($('#sampleTable').bootstrapTable('getSelections'), function (row) {
					return row.fq;
				});
				$('#sampleTable').bootstrapTable('remove', {
					field: 'fq',
					values: ids
				});
			};
			if(samplesLock == 0){
				alert("样本已经锁定，请先解锁")
				}
        });
    });

</script>
	<!-- ##################　样本分组、比较、维恩图　################## -->
	<script>

//锁定样本的状态
var samplesLock=1 //没有锁定
var samples = []
//点击锁定样本，获得样本名称
bindGroupClick()
$("#getSamples").click(function(){
	if(samplesLock == 1){
		var data = $("#sampleTable").bootstrapTable('getData');
		if(data.length == 0){
			alert("还没有选择样本")
			}
		else{
			var array = new Array()    //用来去重
			for(var i=0;i<data.length;i++){
				var name = data[i]["sample"]
				if($.inArray(name, array) == -1){
					array.push(name)
					add='<li class="list-group-item ui-widget-content ui-corner-tr">'+name+'</li>'
					$(add).appendTo('#sampleNames')
				};
			samples = array;
				
			};
			dragInit();
			samplesLock = 0;
			$("#unlockSamples").attr("class","btn btn_orange round_Button");
			$("#getSamples").attr("class","btn btn_white round_Button");
		};
	};
}); 
//解锁样本
$("#unlockSamples").click(function(){
	samplesLock = 1;
	$("#unlockSamples").attr("class","btn btn_white round_Button");
	$("#getSamples").attr("class","btn btn_orange round_Button");
//	$("#sampleTable").bootstrapTable('removeAll');
	$('#sampleNames').html("");
	$('#groupList').html("");
	$('#compareList').html("");
	$('#vennList').html("");
	});



//var curCont=null;
function dragInit() {
	var $sampleNames = $( "#sampleNames" ),
    		$sampleGroup = $( ".sampleGroup" ),
    		$compareGroup = $(".goupCompare")
    		$venn = $(".venn");
	//样本拖动
	$( "li", $sampleNames ).draggable({
	      cancel: "a.ui-icon", // 点击一个图标不会启动拖拽
	      revert: "invalid", // 当未被放置时，条目会还原回它的初始位置
	      containment: "document",
	      helper: "clone",
	      cursor: "move"
	    });
	//分组拖动
	$( ".sampleGroup" ).draggable({
	      cancel: "li",
	      revert: "invalid", 
	      containment: "document",
	      helper: "clone",
	      cursor: "move"
	   });
	
	//比较组拖动
	$(".goupCompare").draggable({
	      cancel: ".list-group-item", 
	      revert: "invalid", 
	      containment: "document",
	      helper: "clone",
	      cursor: "move"
	    });
	//维恩图接收比较组名
	$venn.droppable({
	      accept: "#compareList>div",
	      activeClass: "ui-state-highlight",
	     // tolerance:"touch",
             tolerance:"pointer",
	      drop: function( event, ui ) {
	        dropItem( ui.draggable ,$(this),'red', 5);
	      }
	    });
	//比较组接收组名
	$compareGroup.droppable({
	      accept: ".sampleGroup",
	      activeClass: "ui-state-highlight",
	      //tolerance:"touch",
                tolerance:"pointer",
	      drop: function( event, ui ) {
	        dropItem( ui.draggable ,$(this),'green',allgroups.length);
	      }
	    });
	//分组接收样本
        var maxNum=$("#sampleNames li").length;
	$sampleGroup.droppable({
	      accept: "#sampleNames > li, .sampleGroup li",
	      activeClass: "ui-state-highlight",
	     // tolerance:"touch",
                tolerance:"pointer",
	      drop: function( event, ui ) {
	       // deleteItem( ui.draggable ,$(this));
                     dropItem( ui.draggable ,$(this),'#333',maxNum);
	      }
	    });
	 
	    // 可以接收从样品组中拖回的样品
	    $sampleNames.droppable({
	     accept: ".sampleGroup li",
	      activeClass: "custom-state-active",
	      drop: function( event, ui ) {
	        recycleItem( ui.draggable );
	      }
	    });
	    function deleteItem( $item ,$container) {
	        $item.fadeOut(function() {
	          var $list = $( "ul", $container ).length ?
	            $( "ul", $container ) :
	            $( "<ul class='sampleNames ui-helper-reset'/>" ).appendTo($container );

	          $item.find( "a.ui-icon-sampleGroup" ).remove();
	          $item.appendTo( $list ).fadeIn(function() {
	            $item
	              .find( "img" )
	                .animate({ height: "36px" });
	          });
	          $item.css("background","none").css("border","none");
	        });
	      }
	    curcontainer= null;
	    function dropItem($item ,$container,$color,maxNum){
               	if($item.context.localName=='li'){
	    		var itemName = $item.text();
	    		var items = $container.find('li');
		    	if(items.length>=maxNum){
		    		alert("³¬³öÁË×îŽóÔÊÐíÊýÄ¿"+maxNum);
		    		return false;
		    	}
		    	for (var i=0; i<items.length; i++){
		    		if($(items[i]).text()==itemName){
		    			alert("ÓÐÖØžŽµÄÌõÄ¿"+itemName+"£¡");
		    			return false;
		    		}
		    	}
	    		var $list = $( "ul", $container ).length ?$( "ul", $container ) :$( "<ul class='sampleNames ui-helper-reset'/>" ).appendTo($container);
			    $('<li class="list-group-item ui-widget-content ui-corner-tr ui-draggable" style="display: block;border:none;background:none; width: 90px;color:'+$color+'">'
		    	+itemName+'</li>').appendTo($list).fadeIn(function() {
		  	            $item
			              	.find( "img" )
			                .animate({ height: "36px" });
			          	});
			        
	    	}else{
	    		var itemName = $item.children("span").text();
		    	//±éÀúcontainer²é¿ŽÒÑ°üº¬ÄÄÐ©ÔªËØ
		    	var containItems= new Array();
		    	var items = $container.find('li');
		    	if(items.length>=maxNum){
		    		alert("³¬³öÁË×îŽóÔÊÐíÊýÄ¿"+maxNum);
		    		return false;
		    	}
		    	for (var i=0; i<items.length; i++){
		    		if($(items[i]).text()==itemName){
		    			alert("ÓÐÖØžŽµÄÌõÄ¿"+itemName+"£¡");
		    			return false;
		    		}
		    	}
		    	
		    	var $list = $( "ul", $container ).length ?
			            $( "ul", $container ) :
			            $( "<ul class='goupCompare ui-helper-reset'/>" ).appendTo($container);
			    $('<li class="list-group-item ui-widget-content ui-corner-tr ui-draggable" style="display: block;border:none;background:none; width: 90px;color:'+$color+'">'
			    	+itemName+'</li>').appendTo($list).fadeIn(function() {
			            $item
			              .find( "img" )
			                .animate({ height: "36px" });
			         });
		    		
	    	}

	    }
	    
	    function recycleItem( $item ) {
	      $item.fadeOut(function() {
	        $item
	          .find( "a.ui-icon-refresh" )
	            .remove()
	          .end()
	          .css("background-color","#FFFFFF").css("border","1px solid #dddddd")
	          .find( "img" )
	            .css( "height", "72px" )
	          .end()
	          .appendTo( $sampleNames )
	          .fadeIn();
	      });
	    }
	    
	    $("#groupList .glyphicon-remove").each(function(){
			$(this).click(function(){
				$(this).parent('div').remove();
				var value=$(this).siblings("span").text();
				var index=$.inArray(value,allgroups);
				allgroups.splice(index,1);
				$("#compareList").find("li").each(function(){
					if($(this).text()==value){
						$(this).remove();
					}
				})
				dragInit();
			})
		});
		$("#compareList .glyphicon-remove").each(function(){
			$(this).click(function(){
				$(this).parent('div').remove();
				var value=$(this).siblings("span").text();
				var index=$.inArray(value,allCompares);
                         $("#vennList").find("li").each(function(){
					if($(this).text()==value){
						$(this).remove();
					}
				})
				allCompares.splice(index,1);
			})
		});
		$("#vennList .glyphicon-remove").each(function(){
			$(this).click(function(){
				$(this).parent('div').remove();
			})
		});
};

var allgroups = new Array();	//all groups
function addGroup(){
	var gname= $("#groupName").val();
	if(gname=='' ||gname==null){
		return false;
	}
	if(-1!=allgroups.indexOf(gname,0)){
		alert('分组名'+gname+"已存在！");
		return false;
	}
	
	if($('#sampleNames li').length <= allgroups.length){
		alert("分组数不能超过样本数！");
		return false;
	}
	$("#groupName").val('');
	var html='<div name="sampleGroup" class="ui-widget-content ui-state-default sampleGroup" style=border-radius:3px;><span class="ui-widget-header" style=font-size:18px;height:28px;border:none;background:none;display:inline-block;>'+gname+'</span><button class="ui-widget-header glyphicon glyphicon-remove pull-right closeBorder" ></span></div>';
	$(html).appendTo('#groupList');
	allgroups.push(gname);
	dragInit();
}

//增加比较组
var allCompares = new Array(); 
function addCompare(){
	if(allgroups.length <2){
		alert('此为组间比较，至少需要两个样本组，请先填写样本组信息！');
		return false;
	}
	var cname= $('#compareName').val().replace(/(^\s*)|(\s*$)/g, "");
	if(cname=='' ||cname==null){
		return false;
	}
	if(-1!=allCompares.indexOf(cname,0)){
		alert('比较组'+cname+"已存在！");
		return false;
	}
	$('#compareName').val('');
	var html='<div name="goupCompare" class="ui-widget-content ui-state-default goupCompare" style=border-radius:3px;><span class="ui-widget-header" style="font-size:18px;color:green;border:none;background:none;height:28px;display:inline-block;" >'+cname+'</span><span class="ui-widget-header glyphicon glyphicon-remove pull-right closeBorder" ></span></div>';
	$(html).appendTo('#compareList');
	allCompares.push(cname);
	dragInit();
}
function addVenn(){
	if(allCompares.length ==0){
		alert("维恩图至少需要两个比较组，请先填写比较组信息！");
		return false;
	}
	var html='<div name="venn" class="ui-widget-content ui-state-default venn" style=border-radius:3px;><span style="height:28px;display:inline-block;"></span><span class="ui-widget-header glyphicon glyphicon-remove closeBorder" style="left: 90%;top:-10px;"></span></div>'
	$(html).appendTo('#vennList');
	dragInit();
}

function bindGroupClick(){
	dragInit();
	$("#groupName").keydown(function(k){
		if(k.keyCode==13 ){
			addGroup();
		}
	});
	$("#addGroup").click(function(){
		addGroup();
	});
	$("#compareName").keydown(function(k){
		if(k.keyCode==13 ){
			addCompare();
		}
	});
	$("#addCompare").click(function(){
		addCompare();
	});
	$("#addVenn").click(function(){
		addVenn();
	});


//保存草稿
$("#saveDraft").click(function(){
		var taskPara = $("#creatTask").serializeArray();
	//	taskPara = JSON.stringify(taskPara);
//选中的模块参数
		var selectPara = $("#parasPanel select[name]").serializeArray();  //选择框
		var inputPara = $("#parasPanel input[name]").serializeArray();   //下拉框
		var nodePara= $.merge(selectPara,inputPara); //合并
	//	nodePara = JSON.stringify(nodePara);
//没选中的模块名字
		var unselectNode="";
		for (var i in nodeStatus){
		  if(nodeStatus[i] == 0){
			if(unselectNode==""){
				unselectNode += i
				}
			else{
				unselectNode += ","+i
				}
		  };
		};
		
		var samplesStr=""
		for(var j=0;j<samples.length;j++ ){  
			if(samplesStr == ""){
				samplesStr += samples[j];
				}
			else{
				samplesStr += ","+samples[j];
				}
		};
		
		var draft={"taskPara":taskPara,
				"nodePara":nodePara,
				"unselectNode":unselectNode,
				"samples":samplesStr
				}; 
		draft = JSON.stringify(draft);
//console.log(draft)
		 $.ajax({
				    url:"/Home/Task/addUpdateTask/submitType/draft",  
				    type:'post',
				    data:{parameter:draft},
				    dataType: "json",
				    success:function(data) {
				    	if(data['status']=='ERROR'){    //请求成功但没有执行成功
				    		alert(data['data']);
				    	}else{
							alert("草稿保存成功！");	
				    	}
				     },    
				     error : function(XMLHttpRequest) {
				       alert(XMLHttpRequest.status +' '+ XMLHttpRequest.statusText);    
				     }
				});  
				
});
//检查参数填写情况
function checkInput(){
	
	var checkTask=$("#creatTask input[name]");
	var checkNode=$("#parasPanel input[name]");

	var count=0; //计数
	for(var i=0;i<checkTask.length;i++){
	  if(checkTask[i].value==""){
		$($("#creatTask input[name]")[i]).attr("style","border-color:red;")
		count += 1;
	  }
	  else{
		$($("#creatTask input[name]")[i]).attr("style","border-color:#ccc;") 
		  };
	};
	
	for(var i=0;i<checkNode.length;i++){
	  if(checkNode[i].value==""){
		$($("#parasPanel input[name]")[i]).attr("style","border-color:red;")
		count += 1;
	  }
	  else{
		$($("#parasPanel input[name]")[i]).attr("style","border-color:#ccc;")  
		  };
	}; 

	if(count != 0){
		alert("还有未填写的参数！");
		};
	if(samplesLock == 1){
		alert("未锁定样本！");
		count += 1;
		}
	/*
	if($("#parasPanel").children().length == 0){
		alert("缺少模块和模块参数！");
		count += 1;
		}
	*/
	return count
	};

//任务运行，提交参数
$("#taskRun").click(function(){
	var nullNum = checkInput()
	if(nullNum==0){
		var groupCompareVenn={};	//发向服务器的json数据
//任务参数有关的信息
		
		var taskPara = $("#creatTask").serializeArray();
	//	taskPara = decodeURIComponent(taskPara,true);
		//taskPara = JSON.stringify(taskPara);
		
//选中的模块参数
		var selectPara = $("#parasPanel select[name]").serializeArray();  //选择框
		
		var inputPara = $("#parasPanel input[name]").serializeArray();   //下拉框
		
		var nodePara= $.merge(selectPara,inputPara); //合并
	//	nodePara = JSON.stringify(nodePara);

//没选中的模块名字
		var unselectNode=""
		for (var i in nodeStatus){
		  if(nodeStatus[i] == 0){
			if(unselectNode==""){
				unselectNode += i
				}
			else{
				unselectNode += ","+i
				}
		  };
		}

		//检查数据
		//检查样本是否已全部分组，非强制
		if($("#sampleNames").find('li').length>0){
			if(!confirm("发现有未分组的样品，确定不分组?")){
				return false;
			}
		}
		//检查是否有分组，每个分组下的样品名
		var groups =$('#groupList').find('div');
		if(groups.length>0){
			var groupSamples= {};
			for(var i=0; i<groups.length; i++){
				var sampleItems = $($(groups[i]).find('ul')[0]).find('li');
				if(sampleItems.length==0){
					continue;
				}
				//组名
				var curGroup =$($(groups[i]).find('span')).text().replace(/(^\s*)|(\s*$)/g, "");  //空格开头或者结尾
				var curGroupSamples = new Array();
				for(var j=0; j < sampleItems.length ;j++){
					curGroupSamples.push($(sampleItems[j]).text().replace(/(^\s*)|(\s*$)/g, ""));
				}
				groupSamples[curGroup]= curGroupSamples;
			}
			groupCompareVenn['groupSamples']= groupSamples;
		}
		
		//检查比较组
		var compares = $('#compareList').find('div');
		if(compares.length>0){
			var compareGroups = {};
			for(var i=0; i<compares.length; i++){
				var groupItems = $($(compares[i]).find('ul')[0]).find('li');
				if(groupItems.length==0){
					continue;
				}
				//比较组名
				var curCompare = $($(compares[i]).find('span')).text().replace(/(^\s*)|(\s*$)/g, "");
				var curCompareGroups = new Array();
				for(var j=0; j<groupItems.length; j++){
					curCompareGroups.push($(groupItems[j]).text().replace(/(^\s*)|(\s*$)/g, ""));
				}
				compareGroups[curCompare] = curCompareGroups;
			}
			groupCompareVenn['compareGroups']= compareGroups;
		}
		//检查venn图
		var venns = $('#vennList').find('div');
		if(venns.length>0){
			var vennCompares= new Array();
			for(var i=0; i<venns.length; i++){
				var compareItems = $($(venns[i]).find('ul')[0]).find('li');
				if(compareItems.length==0){
					continue;
				}
				//维恩图没有命名,仅存在数组中
				var curVennCompares = new Array();
				for(var j=0; j<compareItems.length; j++){
					curVennCompares.push($(compareItems[j]).text().replace(/(^\s*)|(\s*$)/g, ""));
				}
				vennCompares.push(curVennCompares);
			}
			groupCompareVenn['vennCompares'] = vennCompares;
		}


		//groupCompareVenn = JSON.stringify(groupCompareVenn);
//		$('#groupCompareVenn').val(JSON.stringify(groupCompareVenn));

//全部的参数	
		var samplesStr=""
		for(var j=0;j<samples.length;j++ ){  
			if(samplesStr == ""){
				samplesStr += samples[j];
				}
			else{
				samplesStr += ","+samples[j];
				}
		};

		var resultPara={"taskPara":taskPara,
						"nodePara":nodePara,
						"unselectNode":unselectNode,
						"samples":samplesStr,
						"groupCompareVenn":groupCompareVenn
						};   
		resultPara = JSON.stringify(resultPara);
				//console.log(resultPara)
//向后台传送数据
		 $.ajax({
				    url:"/Home/Task/addUpdateTask/submitType/job",  
				    type:'post',
				    data:{parameter:resultPara},
				    dataType: "json",
				    success:function(data) {
				    	if(data['status']=='ERROR'){    //请求成功但没有执行成功
                                       alert("执行成功！");
                                   window.location.href= "/Home/Mainnobase/index?sndType_f=flow";
				    		//alert(data['data']);
				    	}else{
				    		$('#id').val(data['data']);
							alert("执行成功！");
							window.location.href= "/Home/Task/getTask/id/"+data['data'];
				    	}
				     },    
				     error : function(XMLHttpRequest) {
                                          alert("执行成功！");
                                  window.location.href= "/Home/Mainnobase/index?sndType_f=flow";
				      // alert(XMLHttpRequest.status +' '+ XMLHttpRequest.statusText); 
				     }
				});  
		}; //检查参数
	  });
	
}

</script>




<div style="top: 0px; z-index: 300; position: fixed; display: none; text-align: center; left: 25%; width: 50%; background-color: rgb(245, 245, 245); padding: 16px; border: 16px solid rgb(68, 68, 68); border-radius: 10px; margin-top: 10px;"></div><div style="z-index: 299; position: fixed; display: none; top: 0px; left: 0px; width: 100%; height: 100%; background-color: black; opacity: 0.8;"></div></body></html>